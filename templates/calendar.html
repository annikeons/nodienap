<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pendientes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylex.css') }}">
</head>

<body>

    <div id="events" class="section active">
        <h1>Pendientes</h1>
        <div class="event-form">
            <input type="text" id="eventName" placeholder="Nombre del evento">
            <input type="time" id="eventStart" placeholder="Inicio">
            <input type="time" id="eventEnd" placeholder="Fin">
            <button type="button" id="addEvent">Agregar Pendiente</button>
        </div>
        <div class="cards" id="eventList"></div>
    </div>

    <script>
        (function () {
            // Theme sync listener
            window.addEventListener('message', function (event) {
                if (event.data.type === 'applyTheme') {
                    document.body.classList.toggle('dark', event.data.theme === 'dark');
                }
            });

            var eventList = document.getElementById('eventList');
            var addBtn = document.getElementById('addEvent');

            function loadEvents() {
                var events = JSON.parse(localStorage.getItem('events') || '[]');
                eventList.innerHTML = '';
                events.forEach(function (ev, index) {
                    var div = document.createElement('div');
                    div.className = 'card';
                    div.style.marginBottom = '15px';
                    div.style.padding = '20px';
                    div.style.display = 'flex';
                    div.style.alignItems = 'center';
                    div.style.justifyContent = 'space-between';
                    div.style.background = 'rgba(255, 255, 255, 0.8)';
                    div.style.borderRadius = '16px';

                    var info = document.createElement('div');
                    info.style.display = 'flex';
                    info.style.alignItems = 'center';
                    info.style.gap = '15px';
                    info.innerHTML = '<img src="' + "{{ url_for('static', filename='agenda.png') }}" + '" style="width:40px; height:40px;">' +
                        '<div><strong style="display:block; font-size:1.1rem;">' + ev.name + '</strong>' +
                        '<span style="color:#666; font-size:0.9rem;">' + ev.start + ' - ' + ev.end + '</span></div>';

                    var btnDelete = document.createElement('button');
                    btnDelete.innerHTML = '‚ùé';
                    btnDelete.className = 'delete-btn';
                    btnDelete.dataset.index = index;
                    btnDelete.style.background = 'transparent';
                    btnDelete.style.boxShadow = 'none';
                    btnDelete.style.fontSize = '1.2rem';
                    btnDelete.style.padding = '5px';

                    div.appendChild(info);
                    div.appendChild(btnDelete);
                    eventList.appendChild(div);
                });
            }

            addBtn.addEventListener('click', function () {
                var name = document.getElementById('eventName').value.trim();
                var start = document.getElementById('eventStart').value;
                var end = document.getElementById('eventEnd').value;
                if (!name || !start || !end) { alert("Completa todos los campos"); return; }
                var events = JSON.parse(localStorage.getItem('events') || '[]');
                events.push({ name: name, start: start, end: end });
                localStorage.setItem('events', JSON.stringify(events));
                loadEvents();
                document.getElementById('eventName').value = '';
                document.getElementById('eventStart').value = '';
                document.getElementById('eventEnd').value = '';
            });

            eventList.addEventListener('click', function (e) {
                if (!e.target.classList.contains('delete-btn')) return;
                var index = parseInt(e.target.getAttribute('data-index'), 10);
                var events = JSON.parse(localStorage.getItem('events') || '[]');
                events.splice(index, 1);
                localStorage.setItem('events', JSON.stringify(events));
                loadEvents();
            });

            loadEvents();
        })();
    </script>

</body>

</html>