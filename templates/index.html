<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nodie</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='stylex.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='sleeper duck.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#ffd500">
</head>
<body>

    <div class="content">
        <div id="home" class="section active">
            <h1 class="animated-text">¬°Que gusto verte!</h1>
            <p class="clancy">Nodie, tu pausa ideal para relajarte<br><br></p>
            <h1 class="animated-text">Palabras Para Ti:</h1>
            <div class="cards consejo-box consejo-card">
                <div class="card">
                    <img src="{{ url_for('static', filename='sleeper duck.png') }}" alt="Nodie">
                    <p id="consejo-texto">Las alarmas no solo son para cuando duermes, tambi√©n cuando est√°s activo y quieres sonidos relajantes</p>
                </div>
            </div>
        </div>

        <div id="nodie" class="section">
            <h1 class="uwu">Nodie</h1>
            <iframe src="/chat" style="width:100%; height: 652px; border:none; border-radius:10px;" title="Chatbot Nodie"></iframe>
        </div>

        <div id="alarm" class="section">
            <h1 class="uwu">Alarma</h1>
            <iframe src="/alarms" style="width:100%; height:652px; border:none; border-radius:10px;" title="Alarmas"></iframe>
        </div>

        <div id="events" class="section">
            <h1 class="uwu">Eventos</h1>
            <iframe src="/calendar" style="width:100%; height:652px; border:none; border-radius:10px;" title="Calendario de eventos"></iframe>
        </div>

        <div id="settings" class="section">
            <h1 class="uwu">Ayuda</h1>
            <iframe src="/ayuda" style="width:100%; height:652px; border:none; border-radius:10px;" title="Ayuda"></iframe>
        </div>
    </div>

    <div class="menu">
        <button onclick="showSection('home', event)" class="active">üèöÔ∏è<span>Home</span></button>
        <button onclick="showSection('alarm', event)">üïú<span>Alarms</span></button>
        <button onclick="showSection('events', event)">üìã<span>Notes</span></button>
        <button onclick="showSection('settings', event)">‚öôÔ∏è<span>Help</span></button>
        <button onclick="showSection('nodie', event)">ü¶Ü<span>Nodie</span></button>
    </div>

    <style>
        @media screen and (max-width: 768px) {
            .lower_navbar_content { flex-direction: column; }
            .lower_navbar .logo { margin-bottom: 8px; }
            .dropdown-menu { width: 100%; }
        }
    </style>

    <script>
        const consejos = [
            "Si solo tienes 30 minutos libres, es mejor relajarte y no dormir",
            "Si quieres chatear con Nodie, revisa *Ayuda*",
            "Nada se compara con contarle tu d√≠a a una persona real",
            "Evita dormir justo antes de tus actividades, podr√≠as sentirte m√°s cansado despu√©s",
            "Un descanso corto puede ayudarte a recuperar energ√≠a y concentraci√≥n",
            "Eres valiente, lo est√°s haciendo bien",
            "Si te sientes agotado, una pausa breve puede marcar la diferencia",
            "Recuerda que descansar tambi√©n es avanzar",
            "T√≥mate un momento para respirar y pensar en ti",
            "No tienes que hacerlo todo hoy, ve paso a paso",
            "Escucha a tu cuerpo, √©l sabe cu√°ndo necesita un respiro",
            "A veces lo mejor que puedes hacer es detenerte un momento",
            "No se trata de hacer m√°s, sino de hacerlo con calma",
            "Descansar no es perder el tiempo, es recuperarlo",
            "Tu bienestar tambi√©n es importante",
            "Una mente tranquila puede con cualquier reto",
            "Hoy tambi√©n cuenta, aunque solo hayas avanzado un poco",
            "Perm√≠tete un momento de silencio, te har√° bien",
            "No siempre tienes que estar al m√°ximo, est√° bien bajar el ritmo",
            "Est√°s creciendo, aprendiendo y avanzando, aunque no siempre lo notes",
            "Cuidarte tambi√©n es parte del progreso",
            "El descanso es parte del camino, no una pausa del destino",
            "Conf√≠a en que est√°s haciendo lo correcto",
            "A veces descansar es la mejor forma de seguir",
            "Tu esfuerzo vale, aunque nadie lo vea",
            "Cada d√≠a es una nueva oportunidad para intentarlo mejor",
            "Hablar con alguien puede ayudarte m√°s de lo que imaginas",
            "No est√°s sola, siempre hay alguien dispuesto a escucharte",
            "A veces compartir lo que sientes alivia m√°s que cualquier descanso",
            "Una buena conversaci√≥n puede cambiarte el d√≠a",
            "Contar lo que te pasa no te hace d√©bil, te hace humana",
            "No todo se soluciona en silencio, hablar tambi√©n sana",
            "Buscar compa√±√≠a cuando lo necesitas es una forma de cuidarte",
            "Hablar con alguien de confianza puede aclarar tu mente",
            "Las palabras compartidas alivian el coraz√≥n",
            "No te guardes todo, hablar tambi√©n libera",
            "A veces solo necesitas que alguien te escuche de verdad",
            "Conectar con alguien puede traer calma a tu d√≠a",
            "Tu voz tambi√©n merece ser escuchada",
            "No est√°s sola/solo, hay personas que se preocupan por ti",
            "Compartir lo que vives hace m√°s ligero el camino",
            "Una charla sincera puede devolverte la paz",
            "Hablar con alguien real te recuerda que no todo se resuelve sola",
            "A veces el mejor descanso es una buena conversaci√≥n",
            "Hablar tambi√©n es una forma de sanar",
            "No tienes que cargar sola con todo lo que sientes"
        ];

        let indice = 0;
        const textoEl = document.getElementById("consejo-texto");

        function cambiarConsejo() {
            if (!textoEl) return;
            textoEl.style.opacity = 0;
            setTimeout(function() {
                indice = (indice + 1) % consejos.length;
                textoEl.textContent = consejos[indice];
                textoEl.style.opacity = 1;
            }, 300);
        }
        setInterval(cambiarConsejo, 6000);
    </script>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(function() { console.log('Service Worker registrado'); })
                .catch(function(err) { console.log('Error Service Worker:', err); });
        }
    </script>

    <script>
        function showSection(sectionId, ev) {
            document.querySelectorAll('.section').forEach(function(sec) {
                sec.style.display = 'none';
            });
            var sec = document.getElementById(sectionId);
            if (sec) sec.style.display = 'block';

            document.querySelectorAll('.menu button').forEach(function(btn) {
                btn.classList.remove('active');
            });
            if (ev && ev.currentTarget) ev.currentTarget.classList.add('active');

            // Audio unlock attempt on interaction
            unlockAudio();
        }

        // Global Audio Unlock
        var audioContextUnlocked = false;
        function unlockAudio() {
            if (audioContextUnlocked) return;
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                const context = new AudioContext();
                if (context.state === 'suspended') {
                    context.resume().then(() => {
                        audioContextUnlocked = true;
                        notifyIframes({ type: 'audioUnlocked' });
                    });
                } else {
                    audioContextUnlocked = true;
                    notifyIframes({ type: 'audioUnlocked' });
                }
            }
        }

        // Theme Sync
        window.addEventListener('message', function(event) {
            if (event.data.type === 'themeChange') {
                document.body.classList.toggle('dark', event.data.theme === 'dark');
                notifyIframes({ type: 'applyTheme', theme: event.data.theme });
            }
        });

        function notifyIframes(data) {
            document.querySelectorAll('iframe').forEach(function(iframe) {
                iframe.contentWindow.postMessage(data, '*');
            });
        }
    </script>

</body>
</html>
